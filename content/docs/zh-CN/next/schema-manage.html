<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>管理 Schema · Apache Pulsar</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="本指南演示了管理 Schema 的方法："/><meta name="docsearch:version" content="next"/><meta name="docsearch:language" content="zh-CN"/><meta property="og:title" content="管理 Schema · Apache Pulsar"/><meta property="og:type" content="website"/><meta property="og:url" content="https://pulsar.incubator.apache.org/"/><meta property="og:description" content="本指南演示了管理 Schema 的方法："/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://pulsar.incubator.apache.org/img/pulsar.svg"/><link rel="shortcut icon" href="/img/pulsar.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"/><link rel="alternate" type="application/atom+xml" href="https://pulsar.incubator.apache.org/blog/atom.xml" title="Apache Pulsar Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://pulsar.incubator.apache.org/blog/feed.xml" title="Apache Pulsar Blog RSS Feed"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-102219959-1', 'auto');
              ga('send', 'pageview');
            </script><link rel="stylesheet" href="/css/code-blocks-buttons.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/custom.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/zh-CN"><img class="logo" src="/img/pulsar.svg" alt="Apache Pulsar"/></a><a href="/zh-CN/versions"><h3>next</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/zh-CN/next/standalone" target="_self">文档</a></li><li class=""><a href="/zh-CN/download" target="_self">下载</a></li><li class="siteNavGroupActive"><a href="/docs/zh-CN/next/client-libraries" target="_self">客户端</a></li><li class=""><a href="#restapis" target="_self">REST API</a></li><li class=""><a href="/blog/" target="_self">博客</a></li><li class=""><a href="#community" target="_self">社区</a></li><li class=""><a href="#apache" target="_self">Apache</a></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/img/language.svg" alt="Languages icon"/>中文</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/docs/en/next/schema-manage">English</a></li><li><a href="/docs/ja/next/schema-manage">日本語</a></li><li><a href="/docs/fr/next/schema-manage">Français</a></li><li><a href="https://crowdin.com/project/apache-pulsar" target="_blank" rel="noreferrer noopener">参与翻译</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(event) {
          event.preventDefault();

          if (languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Pulsar Schema</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Get started</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/pulsar-2.0">Pulsar-2.0</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/standalone">在本地运行Pulsar</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/standalone-docker">在Docker中运行Pulsar</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/client-libraries">将 Pulsar 与客户端库一起使用</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">概念和架构</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/concepts-overview">概述</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/concepts-messaging">消息传送</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/concepts-architecture-overview">Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/concepts-clients">客户端</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/concepts-replication">基于地理位置的备份</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/concepts-multi-tenancy">多租户</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/concepts-authentication">认证和授权</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/concepts-topic-compaction">消息压缩</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/concepts-tiered-storage">Tiered Storage</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/concepts-schema-registry">concepts-schema-registry</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Pulsar Schema</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/schema-get-started">Get started</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/schema-understand">Understand schema</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/schema-evolution-compatibility">Schema evolution and compatibility</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/zh-CN/next/schema-manage">管理 Schema</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Pulsar Functions</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/functions-overview">概述</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/functions-worker">Setup: Pulsar Functions Worker</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/functions-runtime">Setup: Configure Functions runtime</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/functions-develop">How-to: Develop</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/functions-debug">How-to: Debug</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/functions-deploy">How-to: Deploy</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/functions-cli">Reference: CLI</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Pulsar IO</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/io-overview">概述</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/io-quickstart">Get started</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/io-use">Use</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/io-debug">Debug</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/io-connectors">内置连接器</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/io-cdc">CDC 连接器</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/io-develop">Develop</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/io-cli">CLI</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Pulsar SQL</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/sql-overview">概述</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/sql-getting-started">Query data</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/sql-deployment-configurations">Configuration and deployment</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/sql-rest-api">REST API</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">部署</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/deploy-aws">Amazon Web Services</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/deploy-kubernetes">Kubernetes</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/deploy-bare-metal">裸机</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/deploy-bare-metal-multi-cluster">裸机多集群部署</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/deploy-dcos">DC/OS</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/deploy-monitoring">Monitoring</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">系统管理</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/administration-zk-bk">ZooKeeper and BookKeeper</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/administration-geo">跨地域复制</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/administration-dashboard">仪表盘</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/administration-pulsar-manager">Pulsar Manager</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/administration-stats">Pulsar statistics</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/administration-load-balance">Load balance</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/administration-proxy">Pulsar proxy</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/administration-upgrade">升级</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">安全</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/security-overview">概述</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/security-tls-transport">使用TLS进行传输加密</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/security-tls-authentication">使用TLS进行认证</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/security-jwt">Authentication using JWT</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/security-athenz">Authentication using Athenz</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/security-kerberos">Authentication using Kerberos</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/security-authorization">Authorization and ACLs</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/security-encryption">End-to-End Encryption</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/security-extending">Extending</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">客户端库</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/client-libraries-java">Java</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/client-libraries-go">Go</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/client-libraries-python">Python</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/client-libraries-cpp">C++</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/client-libraries-node">Node.js
</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/client-libraries-websocket">WebSocket</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Admin API</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/admin-api-overview">概述</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/admin-api-clusters">集群</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/admin-api-tenants">租户</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/admin-api-brokers">Brokers</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/admin-api-namespaces">命名空间</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/admin-api-permissions">Permissions</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/admin-api-persistent-topics">持久topic</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/admin-api-non-persistent-topics">非持久topic</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/admin-api-partitioned-topics">Partitioned topics</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/admin-api-non-partitioned-topics">非分区主题</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/admin-api-schemas">Schema</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/admin-api-functions">Functions</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">适配器</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/adaptors-kafka">Kafka 客户端封装</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/adaptors-spark">Apache Spark</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/adaptors-storm">Apache Storm</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">参考手册</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/cookbooks-tiered-storage">Tiered Storage</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/cookbooks-compaction">Topic compaction</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/cookbooks-deduplication">Message deduplication</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/cookbooks-non-persistent">非持久化消息</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/cookbooks-partitioned">分区主题</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/cookbooks-retention-expiry">消息保留和到期</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/cookbooks-encryption">Encryption</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/cookbooks-message-queue">消息队列</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/cookbooks-bookkeepermetadata">BookKeeper Ledger Metadata</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">开发</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/develop-tools">Simulation tools</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/develop-binary-protocol">Binary protocol</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/develop-load-manager">Modular load manager</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/develop-cpp">编译Pulsar C++ 客户端</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">参考</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/reference-terminology">术语</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/reference-cli-tools">Pulsar CLI tools</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/pulsar-admin">Pulsar Admin CLI</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/reference-connector-admin">Connector Admin CLI</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/reference-configuration">Pulsar configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/reference-metrics">Pulsar Metrics</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://crowdin.com/project/apache-pulsar/zh-CN" target="_blank" rel="noreferrer noopener">Translate</a><h1 id="__docusaurus" class="postHeaderTitle">管理 Schema</h1></header><article><div><span><p>本指南演示了管理 Schema 的方法：</p>
<ul>
<li><p>自动</p>
<ul>
<li><a href="#schema-autoupdate">Schema 自动更新</a></li>
</ul></li>
<li><p>手动</p>
<ul>
<li><p><a href="#schema-manual-management">Schema 手动管理</a></p></li>
<li><p><a href="#custom-schema-storage">自定义schema存储</a></p></li>
</ul></li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="schema-自动更新"></a><a href="#schema-自动更新" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Schema 自动更新</h2>
<p>如果某个方案通过了方案兼容性检查，则 Pulsar 生产商会自动将此方案更新为默认情况下产生的主题。</p>
<h3><a class="anchor" aria-hidden="true" id="生产者端的自动更新"></a><a href="#生产者端的自动更新" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>生产者端的自动更新</h3>
<p>对生产者来说 <code>AutoUpdate</code> 发生在以下集中情况：</p>
<ul>
<li><p>如果<strong>主题没有架构</strong>，则Pulsar会自动注册一个架构。</p></li>
<li><p>如果<strong>主题具有架构</strong>：</p>
<ul>
<li><p>如果<strong>生产者不携带模式</strong>：</p>
<ul>
<li><p>如果在主题所属的名称空间中<code>isSchemaValidationEnforced</code>或<code>schemaValidationEnforced</code><strong>已禁用</strong>，则允许生产者连接到该主题并产生数据。</p></li>
<li><p>如果在主题所属的名称空间中** 启用了**<code>isSchemaValidationEnforced</code>或<code>schemaValidationEnforced</code> 则生产者将被拒绝并断开连接。</p></li>
</ul></li>
<li><p>如果<strong>生产者带有模式</strong>：</p>
<pre><code class="hljs">代理根据主题所属的名称空间的已配置兼容性检查策略执行兼容性检查。
</code></pre>
<ul>
<li><p>If the schema is registered, a producer is connected to a broker.</p></li>
<li><p>If the schema is not registered:</p>
<pre><code class="hljs">* If `isAllowAutoUpdateSchema` sets to **false**, the producer is rejected to connect to a broker.

* If `isAllowAutoUpdateSchema` sets to **true**:
    
    * If the schema passes the compatibility check, then the broker registers a new schema automatically for the topic and the producer is connected.
    
    * If the schema does not pass the compatibility check, then the broker does not register a schema and the producer is rejected to connect to a broker.
</code></pre></li>
</ul></li>
</ul></li>
</ul>
<p><img src="/docs/assets/schema-producer.png" alt="AutoUpdate Producer"></p>
<h3><a class="anchor" aria-hidden="true" id="消费端的自动更新"></a><a href="#消费端的自动更新" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>消费端的自动更新</h3>
<p>对于消费者，在以下情况下会发生<code>AutoUpdate</code>：</p>
<ul>
<li><p>如果 <strong>消费者在不使用模式</strong> 的情况下连接到主题（这意味着使用者接收原始字节），则消费者可以成功连接到该主题而无需进行任何兼容性检查。</p></li>
<li><p>If a <strong>consumer connects to a topic with a schema</strong>.</p>
<ul>
<li><p>If a topic does not have all of them (a schema/data/a local consumer and a local producer):</p>
<ul>
<li><p>If <code>isAllowAutoUpdateSchema</code> sets to <strong>true</strong>, then the consumer registers a schema and it is connected to a broker.</p></li>
<li><p>If <code>isAllowAutoUpdateSchema</code> sets to <strong>false</strong>, then the consumer is rejected to connect to a broker.</p></li>
</ul></li>
<li><p>If a topic has one of them (a schema/data/a local consumer and a local producer), then the schema compatibility check is performed.</p>
<ul>
<li><p>If the schema passes the compatibility check, then the consumer is connected to the broker.</p></li>
<li><p>If the schema does not pass the compatibility check, then the consumer is rejected to connect to the broker.</p></li>
</ul></li>
</ul></li>
</ul>
<p><img src="/docs/assets/schema-consumer.png" alt="AutoUpdate Consumer"></p>
<h3><a class="anchor" aria-hidden="true" id="管理自动更新策略"></a><a href="#管理自动更新策略" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>管理自动更新策略</h3>
<p>您可以使用<code>pulsar-admin</code>命令来管理<code>AutoUpdate</code>策略，如下所示：</p>
<ul>
<li><p><a href="#enable-autoupdate">Enable AutoUpdate</a></p></li>
<li><p><a href="#disable-autoupdate">禁用自动更新</a></p></li>
<li><p><a href="#adjust-compatibility">调整兼容性</a></p></li>
</ul>
<h4><a class="anchor" aria-hidden="true" id="enable-autoupdate"></a><a href="#enable-autoupdate" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Enable AutoUpdate</h4>
<p>To enable <code>AutoUpdate</code> on a namespace, you can use the <code>pulsar-admin</code> command.</p>
<pre><code class="hljs css language-bash">bin/pulsar-admin namespaces <span class="hljs-built_in">set</span>-is-allow-auto-update-schema --<span class="hljs-built_in">enable</span> tenant/namespace
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="禁用自动更新"></a><a href="#禁用自动更新" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>禁用自动更新</h4>
<p>要在名称空间上禁用<code>AutoUpdate</code>，可以使用<code>pulsar-admin</code>命令。</p>
<pre><code class="hljs css language-bash">bin/pulsar-admin namespaces <span class="hljs-built_in">set</span>-is-allow-auto-update-schema --<span class="hljs-built_in">disable</span> tenant/namespace
</code></pre>
<p>禁用<code>AutoUpdate</code>后，你只能使用<code>pulsar-admin</code>命令注册新的架构。</p>
<h4><a class="anchor" aria-hidden="true" id="调整兼容性"></a><a href="#调整兼容性" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>调整兼容性</h4>
<p>要调整名称空间上的架构兼容性级别，可以使用<code>pulsar-admin</code>命令。</p>
<pre><code class="hljs css language-bash">bin/pulsar-admin namespaces <span class="hljs-built_in">set</span>-schema-compatibility-strategy --compatibility &lt;compatibility-level&gt; tenant/namespace
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="schema-验证"></a><a href="#schema-验证" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Schema 验证</h3>
<p>默认情况下，对于生产者，<code>schemaValidationEnforced</code>** 被禁用**：</p>
<ul>
<li><p>这意味着没有模式的生产者可以使用模式向主题生成任何类型的消息，这可能会导致向主题生成垃圾数据。</p></li>
<li><p>这样，不支持架构的非 Java 语言客户端就可以使用架构向主题生成消息。</p></li>
</ul>
<p>但是，如果你希望对具有架构的主题有更强的保证，则可以在整个群集中或在每个命名空间的基础上启用<code>schemaValidationEnforced</code>。</p>
<h4><a class="anchor" aria-hidden="true" id="启用-schema-验证"></a><a href="#启用-schema-验证" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>启用 Schema 验证</h4>
<p>要在名称空间上启用<code>schemaValidationEnforced</code>，可以使用<code>pulsar-admin</code>命令。</p>
<pre><code class="hljs css language-bash">bin/pulsar-admin namespaces <span class="hljs-built_in">set</span>-schema-validation-enforce --<span class="hljs-built_in">enable</span> tenant/namespace
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="禁用-schema-验证"></a><a href="#禁用-schema-验证" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>禁用 Schema 验证</h4>
<p>要在名称空间上禁用<code>schemaValidationEnforced</code>，可以使用<code>pulsar-admin</code>命令。</p>
<pre><code class="hljs css language-bash">bin/pulsar-admin namespaces <span class="hljs-built_in">set</span>-schema-validation-enforce --<span class="hljs-built_in">disable</span> tenant/namespace
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="schema-手动管理"></a><a href="#schema-手动管理" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Schema 手动管理</h2>
<p>若要管理架构，可以使用以下方法之一。</p>
<table style="table">
  <tr>
    <th>
      方法
    </th>
<pre><code class="hljs">&lt;th&gt;
  说明：
&lt;/th&gt;
</code></pre>
  </tr>
  <tr>
    <td>
      **Admin CLI**
    </td>
<pre><code class="hljs">&lt;td&gt;
  You can use the `pulsar-admin` tool to manage Pulsar schemas, brokers, clusters, sources, sinks, topics, tenants and so on. For more information about how to use the `pulsar-admin` tool, see [here](/docs/zh-CN/next/pulsar-admin).
&lt;/td&gt;
</code></pre>
  </tr>
  <tr>
    <td>
      **REST API**
    </td>
<pre><code class="hljs">&lt;td&gt;
  Pulsar exposes schema related management API in Pulsar’s admin RESTful API. You can access the admin RESTful endpoint directly to manage schemas. For more information about how to use the Pulsar REST API, see [here](http://pulsar.apache.org/admin-rest-api/).
&lt;/td&gt;
</code></pre>
  </tr>
  <tr>
    <td>
      **Java Admin API**
    </td>
<pre><code class="hljs">&lt;td&gt;
  Pulsar provides Java admin library.
&lt;/td&gt;
</code></pre>
  </tr>
</table>
<h3><a class="anchor" aria-hidden="true" id="upload-a-schema"></a><a href="#upload-a-schema" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Upload a schema</h3>
<p>To upload (register) a new schema for a topic, you can use one of the following methods.</p>
<div class="tabs"><div class="nav-tabs"><div id="tab-group-535-tab-536" class="nav-link active" data-group="group_535" data-tab="tab-group-535-content-536">Admin CLI</div><div id="tab-group-535-tab-537" class="nav-link" data-group="group_535" data-tab="tab-group-535-content-537">REST API</div><div id="tab-group-535-tab-538" class="nav-link" data-group="group_535" data-tab="tab-group-535-content-538">Java Admin API</div></div><div class="tab-content"><div id="tab-group-535-content-536" class="tab-pane active" data-group="group_535" tabindex="-1"><div><span><p>Use the <code>upload</code> subcommand.</p>
<pre><code class="hljs css language-bash">$ pulsar-admin schemas upload --filename &lt;schema-definition-file&gt; &lt;topic-name&gt;<br /></code></pre>
<p>The <code>schema-definition-file</code> is in JSON format.</p>
<pre><code class="hljs css language-json">{<br />    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"&lt;schema-type&gt;"</span>,<br />    <span class="hljs-attr">"schema"</span>: <span class="hljs-string">"&lt;an-utf8-encoded-string-of-schema-definition-data&gt;"</span>,<br />    <span class="hljs-attr">"properties"</span>: {} <span class="hljs-comment">// the properties associated with the schema</span><br />}<br /></code></pre>
<p>The <code>schema-definition-file</code> includes the following fields:</p>
<table style="table">
  <tr>
    <th>
      字段
    </th>
<pre><code class="hljs">&lt;th&gt;<br />  说明：<br />&lt;/th&gt;<br /></code></pre>
  </tr>
  <tr>
    <td>
      `type`
    </td>
<pre><code class="hljs">&lt;td&gt;<br />  The schema type.<br />&lt;/td&gt;<br /></code></pre>
  </tr>
  <tr>
    <td>
      `schema`
    </td>
<pre><code class="hljs">&lt;td&gt;<br />  The schema definition data, which is encoded in UTF 8 charset. * If the schema is a **primitive** schema, this field should be blank. * If the schema is a **struct** schema, this field should be a JSON string of the Avro schema definition.<br />&lt;/td&gt;<br /></code></pre>
  </tr>
  <tr>
    <td>
      `properties`
    </td>
<pre><code class="hljs">&lt;td&gt;<br />  The additional properties associated with the schema.<br />&lt;/td&gt;<br /></code></pre>
  </tr>
</table>
<p>Here are examples of the <code>schema-definition-file</code> for a JSON schema.</p>
<p><strong>Example 1</strong></p>
<pre><code class="hljs css language-json">{<br />    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"JSON"</span>,<br />    <span class="hljs-attr">"schema"</span>: <span class="hljs-string">"{\"type\":\"record\",\"name\":\"User\",\"namespace\":\"com.foo\",\"fields\":[{\"name\":\"file1\",\"type\":[\"null\",\"string\"],\"default\":null},{\"name\":\"file2\",\"type\":\"string\",\"default\":null},{\"name\":\"file3\",\"type\":[\"null\",\"string\"],\"default\":\"dfdf\"}]}"</span>,<br />    <span class="hljs-attr">"properties"</span>: {}<br />}<br /></code></pre>
<p><strong>Example 2</strong></p>
<pre><code class="hljs css language-json">{<br />    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"STRING"</span>,<br />    <span class="hljs-attr">"schema"</span>: <span class="hljs-string">""</span>,<br />    <span class="hljs-attr">"properties"</span>: {<br />        <span class="hljs-attr">"key1"</span>: <span class="hljs-string">"value1"</span><br />    }<br />}<br /></code></pre>
</span></div></div><div id="tab-group-535-content-537" class="tab-pane" data-group="group_535" tabindex="-1"><div><span><p>Send a <code>POST</code> request to this endpoint: <a href="https://pulsar.incubator.apache.org/en/admin-rest-api#operation/uploadSchema"><b>POST</b> <i>/admin/v2/schemas/:tenant/:namespace/:topic/schema</i></a>
</p>
<p>The post payload is in JSON format.</p>
<pre><code class="hljs css language-json">{<br />    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"&lt;schema-type&gt;"</span>,<br />    <span class="hljs-attr">"schema"</span>: <span class="hljs-string">"&lt;an-utf8-encoded-string-of-schema-definition-data&gt;"</span>,<br />    <span class="hljs-attr">"properties"</span>: {} <span class="hljs-comment">// the properties associated with the schema</span><br />}<br /></code></pre>
<p>The post payload includes the following fields:</p>
<table style="table">
  <tr>
    <th>
      字段
    </th>
<pre><code class="hljs">&lt;th&gt;<br />  说明：<br />&lt;/th&gt;<br /></code></pre>
  </tr>
  <tr>
    <td>
      `type`
    </td>
<pre><code class="hljs">&lt;td&gt;<br />  The schema type.<br />&lt;/td&gt;<br /></code></pre>
  </tr>
  <tr>
    <td>
      `schema`
    </td>
<pre><code class="hljs">&lt;td&gt;<br />  The schema definition data, which is encoded in UTF 8 charset. * If the schema is a **primitive** schema, this field should be blank. * If the schema is a **struct** schema, this field should be a JSON string of the Avro schema definition.<br />&lt;/td&gt;<br /></code></pre>
  </tr>
  <tr>
    <td>
      `properties`
    </td>
<pre><code class="hljs">&lt;td&gt;<br />  The additional properties associated with the schema.<br />&lt;/td&gt;<br /></code></pre>
  </tr>
</table>
</span></div></div><div id="tab-group-535-content-538" class="tab-pane" data-group="group_535" tabindex="-1"><div><span><pre><code class="hljs css language-java"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">createSchema</span><span class="hljs-params">(String topic, PostSchemaPayload schemaPayload)</span><br /></span></code></pre>
<p>The <code>PostSchemaPayload</code> includes the following fields:</p>
<table style="table">
  <tr>
    <th>
      字段
    </th>
<pre><code class="hljs">&lt;th&gt;<br />  说明：<br />&lt;/th&gt;<br /></code></pre>
  </tr>
  <tr>
    <td>
      `type`
    </td>
<pre><code class="hljs">&lt;td&gt;<br />  The schema type.<br />&lt;/td&gt;<br /></code></pre>
  </tr>
  <tr>
    <td>
      `schema`
    </td>
<pre><code class="hljs">&lt;td&gt;<br />  The schema definition data, which is encoded in UTF 8 charset. * If the schema is a **primitive** schema, this field should be blank. * If the schema is a **struct** schema, this field should be a JSON string of the Avro schema definition.<br />&lt;/td&gt;<br /></code></pre>
  </tr>
  <tr>
    <td>
      `properties`
    </td>
<pre><code class="hljs">&lt;td&gt;<br />  The additional properties associated with the schema.<br />&lt;/td&gt;<br /></code></pre>
  </tr>
</table>
<p>Here is an example of <code>PostSchemaPayload</code>:</p>
<pre><code class="hljs css language-java">PulsarAdmin admin = …;<br /><br />PostSchemaPayload payload = <span class="hljs-keyword">new</span> PostSchemaPayload();<br />payload.setType(<span class="hljs-string">"INT8"</span>);<br />payload.setSchema(<span class="hljs-string">""</span>);<br /><br />admin.createSchema(<span class="hljs-string">"my-tenant/my-ns/my-topic"</span>, payload); <br /></code></pre>
</span></div></div></div></div>
<h3><a class="anchor" aria-hidden="true" id="get-a-schema-latest"></a><a href="#get-a-schema-latest" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Get a schema (latest)</h3>
<p>To get the latest schema for a topic, you can use one of the following methods.</p>
<div class="tabs"><div class="nav-tabs"><div id="tab-group-539-tab-540" class="nav-link active" data-group="group_539" data-tab="tab-group-539-content-540">Admin CLI</div><div id="tab-group-539-tab-541" class="nav-link" data-group="group_539" data-tab="tab-group-539-content-541">REST API</div><div id="tab-group-539-tab-542" class="nav-link" data-group="group_539" data-tab="tab-group-539-content-542">Java Admin API</div></div><div class="tab-content"><div id="tab-group-539-content-540" class="tab-pane active" data-group="group_539" tabindex="-1"><div><span><p>Use the <code>get</code> subcommand.</p>
<pre><code class="hljs css language-bash">$ pulsar-admin schemas get &lt;topic-name&gt;<br /><br />{<br />    <span class="hljs-string">"version"</span>: 0,<br />    <span class="hljs-string">"type"</span>: <span class="hljs-string">"String"</span>,<br />    <span class="hljs-string">"timestamp"</span>: 0,<br />    <span class="hljs-string">"data"</span>: <span class="hljs-string">"string"</span>,<br />    <span class="hljs-string">"properties"</span>: {<br />        <span class="hljs-string">"property1"</span>: <span class="hljs-string">"string"</span>,<br />        <span class="hljs-string">"property2"</span>: <span class="hljs-string">"string"</span><br />    }<br />}<br /></code></pre>
</span></div></div><div id="tab-group-539-content-541" class="tab-pane" data-group="group_539" tabindex="-1"><div><span><p>Send a <code>GET</code> request to this endpoint: <a href="https://pulsar.incubator.apache.org/en/admin-rest-api#operation/getSchema"><b>GET</b> <i>/admin/v2/schemas/:tenant/:namespace/:topic/schema</i></a>
</p>
<p>Here is an example of a response, which is returned in JSON format.</p>
<pre><code class="hljs css language-json">{<br />    <span class="hljs-attr">"version"</span>: <span class="hljs-string">"&lt;the-version-number-of-the-schema&gt;"</span>,<br />    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"&lt;the-schema-type&gt;"</span>,<br />    <span class="hljs-attr">"timestamp"</span>: <span class="hljs-string">"&lt;the-creation-timestamp-of-the-version-of-the-schema&gt;"</span>,<br />    <span class="hljs-attr">"data"</span>: <span class="hljs-string">"&lt;an-utf8-encoded-string-of-schema-definition-data&gt;"</span>,<br />    <span class="hljs-attr">"properties"</span>: {} <span class="hljs-comment">// the properties associated with the schema</span><br />}<br /></code></pre>
<p>The response includes the following fields:</p>
<table style="table">
  <tr>
    <th>
      字段
    </th>
<pre><code class="hljs">&lt;th&gt;<br />  说明：<br />&lt;/th&gt;<br /></code></pre>
  </tr>
  <tr>
    <td>
      `version`
    </td>
<pre><code class="hljs">&lt;td&gt;<br />  The schema version, which is a long number.<br />&lt;/td&gt;<br /></code></pre>
  </tr>
  <tr>
    <td>
      `type`
    </td>
<pre><code class="hljs">&lt;td&gt;<br />  The schema type.<br />&lt;/td&gt;<br /></code></pre>
  </tr>
  <tr>
    <td>
      `timestamp`
    </td>
<pre><code class="hljs">&lt;td&gt;<br />  The timestamp of creating this version of schema.<br />&lt;/td&gt;<br /></code></pre>
  </tr>
  <tr>
    <td>
      `data`
    </td>
<pre><code class="hljs">&lt;td&gt;<br />  The schema definition data, which is encoded in UTF 8 charset. * If the schema is a **primitive** schema, this field should be blank. * If the schema is a **struct** schema, this field should be a JSON string of the Avro schema definition.<br />&lt;/td&gt;<br /></code></pre>
  </tr>
  <tr>
    <td>
      `properties`
    </td>
<pre><code class="hljs">&lt;td&gt;<br />  The additional properties associated with the schema.<br />&lt;/td&gt;<br /></code></pre>
  </tr>
</table>
</span></div></div><div id="tab-group-539-content-542" class="tab-pane" data-group="group_539" tabindex="-1"><div><span><pre><code class="hljs css language-java"><span class="hljs-function">SchemaInfo <span class="hljs-title">createSchema</span><span class="hljs-params">(String topic)</span><br /></span></code></pre>
<p>The <code>SchemaInfo</code> includes the following fields:</p>
<table style="table">
  <tr>
    <th>
      字段
    </th>
<pre><code class="hljs">&lt;th&gt;<br />  说明：<br />&lt;/th&gt;<br /></code></pre>
  </tr>
  <tr>
    <td>
      `name`
    </td>
<pre><code class="hljs">&lt;td&gt;<br />  The schema name.<br />&lt;/td&gt;<br /></code></pre>
  </tr>
  <tr>
    <td>
      `type`
    </td>
<pre><code class="hljs">&lt;td&gt;<br />  The schema type.<br />&lt;/td&gt;<br /></code></pre>
  </tr>
  <tr>
    <td>
      `schema`
    </td>
<pre><code class="hljs">&lt;td&gt;<br />  A byte array of the schema definition data, which is encoded in UTF 8 charset. * If the schema is a **primitive** schema, this byte array should be empty. * If the schema is a **struct** schema, this field should be a JSON string of the Avro schema definition converted to a byte array.<br />&lt;/td&gt;<br /></code></pre>
  </tr>
  <tr>
    <td>
      `properties`
    </td>
<pre><code class="hljs">&lt;td&gt;<br />  The additional properties associated with the schema.<br />&lt;/td&gt;<br /></code></pre>
  </tr>
</table>
<p>Here is an example of <code>SchemaInfo</code>:</p>
<pre><code class="hljs css language-java">PulsarAdmin admin = …;<br /><br />SchemaInfo si = admin.getSchema(<span class="hljs-string">"my-tenant/my-ns/my-topic"</span>); <br /></code></pre>
</span></div></div></div></div>
<h3><a class="anchor" aria-hidden="true" id="get-a-schema-specific"></a><a href="#get-a-schema-specific" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Get a schema (specific)</h3>
<p>To get a specific version of a schema, you can use one of the following methods.</p>
<div class="tabs"><div class="nav-tabs"><div id="tab-group-543-tab-544" class="nav-link active" data-group="group_543" data-tab="tab-group-543-content-544">Admin CLI</div><div id="tab-group-543-tab-545" class="nav-link" data-group="group_543" data-tab="tab-group-543-content-545">REST API</div><div id="tab-group-543-tab-546" class="nav-link" data-group="group_543" data-tab="tab-group-543-content-546">Java Admin API</div></div><div class="tab-content"><div id="tab-group-543-content-544" class="tab-pane active" data-group="group_543" tabindex="-1"><div><span><p>Use the <code>get</code> subcommand.</p>
<pre><code class="hljs css language-bash">$ pulsar-admin schemas get &lt;topic-name&gt; --version=&lt;version&gt; <br /></code></pre>
</span></div></div><div id="tab-group-543-content-545" class="tab-pane" data-group="group_543" tabindex="-1"><div><span><p>Send a <code>GET</code> request to a schema endpoint: <a href="https://pulsar.incubator.apache.org/en/admin-rest-api#operation/getSchema"><b>GET</b> <i>/admin/v2/schemas/:tenant/:namespace/:topic/schema/:version</i></a>
</p>
<p>Here is an example of a response, which is returned in JSON format.</p>
<pre><code class="hljs css language-json">{<br />    <span class="hljs-attr">"version"</span>: <span class="hljs-string">"&lt;the-version-number-of-the-schema&gt;"</span>,<br />    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"&lt;the-schema-type&gt;"</span>,<br />    <span class="hljs-attr">"timestamp"</span>: <span class="hljs-string">"&lt;the-creation-timestamp-of-the-version-of-the-schema&gt;"</span>,<br />    <span class="hljs-attr">"data"</span>: <span class="hljs-string">"&lt;an-utf8-encoded-string-of-schema-definition-data&gt;"</span>,<br />    <span class="hljs-attr">"properties"</span>: {} <span class="hljs-comment">// the properties associated with the schema</span><br />}<br /></code></pre>
<p>The response includes the following fields:</p>
<table style="table">
  <tr>
    <th>
      字段
    </th>
<pre><code class="hljs">&lt;th&gt;<br />  说明：<br />&lt;/th&gt;<br /></code></pre>
  </tr>
  <tr>
    <td>
      `version`
    </td>
<pre><code class="hljs">&lt;td&gt;<br />  The schema version, which is a long number.<br />&lt;/td&gt;<br /></code></pre>
  </tr>
  <tr>
    <td>
      `type`
    </td>
<pre><code class="hljs">&lt;td&gt;<br />  The schema type.<br />&lt;/td&gt;<br /></code></pre>
  </tr>
  <tr>
    <td>
      `timestamp`
    </td>
<pre><code class="hljs">&lt;td&gt;<br />  The timestamp of creating this version of schema.<br />&lt;/td&gt;<br /></code></pre>
  </tr>
  <tr>
    <td>
      `data`
    </td>
<pre><code class="hljs">&lt;td&gt;<br />  The schema definition data, which is encoded in UTF 8 charset. * If the schema is a **primitive** schema, this field should be blank. * If the schema is a **struct** schema, this field should be a JSON string of the Avro schema definition.<br />&lt;/td&gt;<br /></code></pre>
  </tr>
  <tr>
    <td>
      `properties`
    </td>
<pre><code class="hljs">&lt;td&gt;<br />  The additional properties associated with the schema.<br />&lt;/td&gt;<br /></code></pre>
  </tr>
</table>
</span></div></div><div id="tab-group-543-content-546" class="tab-pane" data-group="group_543" tabindex="-1"><div><span><pre><code class="hljs css language-java"><span class="hljs-function">SchemaInfo <span class="hljs-title">createSchema</span><span class="hljs-params">(String topic, <span class="hljs-keyword">long</span> version)</span><br /></span></code></pre>
<p>The <code>SchemaInfo</code> includes the following fields:</p>
<table style="table">
  <tr>
    <th>
      字段
    </th>
<pre><code class="hljs">&lt;th&gt;<br />  说明：<br />&lt;/th&gt;<br /></code></pre>
  </tr>
  <tr>
    <td>
      `name`
    </td>
<pre><code class="hljs">&lt;td&gt;<br />  The schema name.<br />&lt;/td&gt;<br /></code></pre>
  </tr>
  <tr>
    <td>
      `type`
    </td>
<pre><code class="hljs">&lt;td&gt;<br />  The schema type.<br />&lt;/td&gt;<br /></code></pre>
  </tr>
  <tr>
    <td>
      `schema`
    </td>
<pre><code class="hljs">&lt;td&gt;<br />  A byte array of the schema definition data, which is encoded in UTF 8. * If the schema is a **primitive** schema, this byte array should be empty. * If the schema is a **struct** schema, this field should be a JSON string of the Avro schema definition converted to a byte array.<br />&lt;/td&gt;<br /></code></pre>
  </tr>
  <tr>
    <td>
      `properties`
    </td>
<pre><code class="hljs">&lt;td&gt;<br />  The additional properties associated with the schema.<br />&lt;/td&gt;<br /></code></pre>
  </tr>
</table>
<p>Here is an example of <code>SchemaInfo</code>:</p>
<pre><code class="hljs css language-java">PulsarAdmin admin = …;<br /><br />SchemaInfo si = admin.getSchema(<span class="hljs-string">"my-tenant/my-ns/my-topic"</span>, <span class="hljs-number">1L</span>);<br /></code></pre>
</span></div></div></div></div>
<h3><a class="anchor" aria-hidden="true" id="extract-a-schema"></a><a href="#extract-a-schema" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Extract a schema</h3>
<p>To provide a schema via a topic, you can use the following method.</p>
<div class="tabs"><div class="nav-tabs"><div id="tab-group-547-tab-548" class="nav-link active" data-group="group_547" data-tab="tab-group-547-content-548">Admin CLI</div></div><div class="tab-content"><div id="tab-group-547-content-548" class="tab-pane active" data-group="group_547" tabindex="-1"><div><span><p>Use the <code>extract</code> subcommand.</p>
<pre><code class="hljs css language-bash">$ pulsar-admin schemas extract --classname &lt;class-name&gt; --jar &lt;jar-path&gt; --<span class="hljs-built_in">type</span> &lt;<span class="hljs-built_in">type</span>-name&gt;<br /></code></pre>
</span></div></div></div></div>
<h3><a class="anchor" aria-hidden="true" id="delete-a-schema"></a><a href="#delete-a-schema" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Delete a schema</h3>
<p>To delete a schema for a topic, you can use one of the following methods.</p>
<blockquote>
<h4><a class="anchor" aria-hidden="true" id="note"></a><a href="#note" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Note</h4>
<p>In any case, the <strong>delete</strong> action deletes <strong>all versions</strong> of a schema registered for a topic.</p>
</blockquote>
<div class="tabs"><div class="nav-tabs"><div id="tab-group-549-tab-550" class="nav-link active" data-group="group_549" data-tab="tab-group-549-content-550">Admin CLI</div><div id="tab-group-549-tab-551" class="nav-link" data-group="group_549" data-tab="tab-group-549-content-551">REST API</div><div id="tab-group-549-tab-552" class="nav-link" data-group="group_549" data-tab="tab-group-549-content-552">Java Admin API</div></div><div class="tab-content"><div id="tab-group-549-content-550" class="tab-pane active" data-group="group_549" tabindex="-1"><div><span><p>Use the <code>delete</code> subcommand.</p>
<pre><code class="hljs css language-bash">$ pulsar-admin schemas delete &lt;topic-name&gt;<br /></code></pre>
</span></div></div><div id="tab-group-549-content-551" class="tab-pane" data-group="group_549" tabindex="-1"><div><span><p>Send a <code>DELETE</code> request to a schema endpoint: <a href="https://pulsar.incubator.apache.org/en/admin-rest-api#operation/deleteSchema"><b>DELETE</b> <i>/admin/v2/schemas/:tenant/:namespace/:topic/schema</i></a>
</p>
<p>Here is an example of a response, which is returned in JSON format.</p>
<pre><code class="hljs css language-json">{<br />    <span class="hljs-attr">"version"</span>: <span class="hljs-string">"&lt;the-latest-version-number-of-the-schema&gt;"</span>,<br />}<br /></code></pre>
<p>The response includes the following field:</p>
<table>
<thead>
<tr><th>字段</th><th>说明：</th></tr>
</thead>
<tbody>
<tr><td><code>version</code></td><td>The schema version, which is a long number.</td></tr>
</tbody>
</table>
</span></div></div><div id="tab-group-549-content-552" class="tab-pane" data-group="group_549" tabindex="-1"><div><span><pre><code class="hljs css language-java"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deleteSchema</span><span class="hljs-params">(String topic)</span><br /></span></code></pre>
<p>Here is an example of deleting a schema.</p>
<pre><code class="hljs css language-java">PulsarAdmin admin = …;<br /><br />admin.deleteSchema(<span class="hljs-string">"my-tenant/my-ns/my-topic"</span>); <br /></code></pre>
</span></div></div></div></div>
<h2><a class="anchor" aria-hidden="true" id="自定义schema存储"></a><a href="#自定义schema存储" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>自定义schema存储</h2>
<p>By default, Pulsar stores various data types of schemas in <a href="https://bookkeeper.apache.org">Apache BookKeeper</a> deployed alongside Pulsar.</p>
<p>However, you can use another storage system if needed.</p>
<h3><a class="anchor" aria-hidden="true" id="implement"></a><a href="#implement" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Implement</h3>
<p>To use a non-default (non-BookKeeper) storage system for Pulsar schemas, you need to implement the following Java interfaces:</p>
<ul>
<li><p><a href="#schemastorage-interface">SchemaStorage 接口</a></p></li>
<li><p><a href="#schemastoragefactory-interface">SchemaStorageFactory接口</a></p></li>
</ul>
<h4><a class="anchor" aria-hidden="true" id="schemastorage-接口"></a><a href="#schemastorage-接口" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>SchemaStorage 接口</h4>
<p><code>SchemaStorage</code>接口包含以下方法：</p>
<pre><code class="hljs css language-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">SchemaStorage</span> </span>{
    <span class="hljs-comment">// 如何更新schema</span>
    <span class="hljs-function">CompletableFuture&lt;SchemaVersion&gt; <span class="hljs-title">put</span><span class="hljs-params">(String key, <span class="hljs-keyword">byte</span>[] value, <span class="hljs-keyword">byte</span>[] hash)</span></span>;

    <span class="hljs-comment">// 如何从存储中获取schema</span>
    <span class="hljs-function">CompletableFuture&lt;StoredSchema&gt; <span class="hljs-title">get</span><span class="hljs-params">(String key, SchemaVersion version)</span></span>;

    <span class="hljs-comment">// 如何删除schema</span>
    <span class="hljs-function">CompletableFuture&lt;SchemaVersion&gt; <span class="hljs-title">delete</span><span class="hljs-params">(String key)</span></span>;

    <span class="hljs-comment">// 用户将schema字节数据转换为SchemaVersion 对象的工具方法</span>
    <span class="hljs-function">SchemaVersion <span class="hljs-title">versionFromBytes</span><span class="hljs-params">(<span class="hljs-keyword">byte</span>[] version)</span></span>;

    <span class="hljs-comment">// 启动schema存储客户端</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">start</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception</span>;

    <span class="hljs-comment">// 关闭schema存储客户端</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">close</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception</span>;
}
</code></pre>
<blockquote>
<h4><a class="anchor" aria-hidden="true" id="tip"></a><a href="#tip" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Tip</h4>
<p>For a complete example of <strong>schema storage</strong> implementation, see <a href="https://github.com/apache/pulsar/blob/master/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/BookkeeperSchemaStorage.java">BookKeeperSchemaStorage</a> class.</p>
</blockquote>
<h4><a class="anchor" aria-hidden="true" id="schemastoragefactory接口"></a><a href="#schemastoragefactory接口" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>SchemaStorageFactory接口</h4>
<p>The <code>SchemaStorageFactory</code> interface has the following method:</p>
<pre><code class="hljs css language-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">SchemaStorageFactory</span> </span>{
    <span class="hljs-meta">@NotNull</span>
    <span class="hljs-function">SchemaStorage <span class="hljs-title">create</span><span class="hljs-params">(PulsarService pulsar)</span> <span class="hljs-keyword">throws</span> Exception</span>;
}
</code></pre>
<blockquote>
<p>Tip</p>
<p>For a complete example of <strong>schema storage factory</strong> implementation, see <a href="https://github.com/apache/pulsar/blob/master/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/BookkeeperSchemaStorageFactory.java">BookKeeperSchemaStorageFactory</a> class.</p>
</blockquote>
<h3><a class="anchor" aria-hidden="true" id="deploy"></a><a href="#deploy" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Deploy</h3>
<p>To use your custom schema storage implementation, perform the following steps.</p>
<ol>
<li><p>将实现打包到 <a href="https://docs.oracle.com/javase/tutorial/deployment/jar/basicsindex.html">JAR</a> 文件中。</p></li>
<li><p>Add the JAR file to the <code>lib</code> folder in your Pulsar binary or source distribution.</p></li>
<li><p>Change the <code>schemaRegistryStorageClassName</code> configuration in <code>broker.conf</code> to your custom factory class.</p></li>
<li><p>Start Pulsar.</p></li>
</ol>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/zh-CN/next/schema-evolution-compatibility"><span class="arrow-prev">← </span><span>Schema evolution and compatibility</span></a><a class="docs-next button" href="/docs/zh-CN/next/functions-overview"><span>概述</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#schema-自动更新">Schema 自动更新</a><ul class="toc-headings"><li><a href="#生产者端的自动更新">生产者端的自动更新</a></li><li><a href="#消费端的自动更新">消费端的自动更新</a></li><li><a href="#管理自动更新策略">管理自动更新策略</a></li><li><a href="#schema-验证">Schema 验证</a></li></ul></li><li><a href="#schema-手动管理">Schema 手动管理</a><ul class="toc-headings"><li><a href="#upload-a-schema">Upload a schema</a></li><li><a href="#get-a-schema-latest">Get a schema (latest)</a></li><li><a href="#get-a-schema-specific">Get a schema (specific)</a></li><li><a href="#extract-a-schema">Extract a schema</a></li><li><a href="#delete-a-schema">Delete a schema</a></li></ul></li><li><a href="#自定义schema存储">自定义schema存储</a><ul class="toc-headings"><li><a href="#implement">Implement</a></li><li><a href="#deploy">Deploy</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="copyright">Copyright © 2019 The Apache Software Foundation. All Rights Reserved. Apache, Apache Pulsar and the Apache feather logo are trademarks of The Apache Software Foundation.</section><span><script>
      const community = document.querySelector("a[href='#community']").parentNode;
      const communityMenu =
        '<li>' +
        '<a id="community-menu" href="#">Community <span style="font-size: 0.75em">&nbsp;▼</span></a>' +
        '<div id="community-dropdown" class="hide">' +
          '<ul id="community-dropdown-items">' +
            '<li><a href="/zh-CN/contact">Contact</a></li>' +
            '<li><a href="/zh-CN/contributing">Contributing</a></li>' +
            '<li><a href="/zh-CN/coding-guide">Coding guide</a></li>' +
            '<li><a href="/zh-CN/events">Events</a></li>' +
            '<li><a href="https://twitter.com/Apache_Pulsar" target="_blank">Twitter &#x2750</a></li>' +
            '<li><a href="https://github.com/apache/pulsar/wiki" target="_blank">Wiki &#x2750</a></li>' +
            '<li><a href="https://github.com/apache/pulsar/issues" target="_blank">Issue tracking &#x2750</a></li>' +
            '<li>&nbsp;</li>' +
            '<li><a href="/zh-CN/resources">Resources</a></li>' +
            '<li><a href="/zh-CN/team">Team</a></li>' +
            '<li><a href="/zh-CN/powered-by">Powered By</a></li>' +
          '</ul>' +
        '</div>' +
        '</li>';

      community.innerHTML = communityMenu;

      const communityMenuItem = document.getElementById("community-menu");
      const communityDropDown = document.getElementById("community-dropdown");
      communityMenuItem.addEventListener("click", function(event) {
        event.preventDefault();

        if (communityDropDown.className == 'hide') {
          communityDropDown.className = 'visible';
        } else {
          communityDropDown.className = 'hide';
        }
      });
    </script></span></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'd226a455cecdd4bc18a554c1b47e5b52',
                indexName: 'apache_pulsar',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["language:zh-CN","version:next"]}
              });
            </script></body></html>