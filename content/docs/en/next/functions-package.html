<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Package Pulsar Functions · Apache Pulsar</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="This section provides step-by-step instructions to package Pulsar functions in Java, Python, and Go. "/><meta name="docsearch:version" content="next"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Package Pulsar Functions · Apache Pulsar"/><meta property="og:type" content="website"/><meta property="og:url" content="https://pulsar.incubator.apache.org/"/><meta property="og:description" content="This section provides step-by-step instructions to package Pulsar functions in Java, Python, and Go. "/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://pulsar.incubator.apache.org/img/pulsar.svg"/><link rel="shortcut icon" href="/img/pulsar.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"/><link rel="alternate" type="application/atom+xml" href="https://pulsar.incubator.apache.org/blog/atom.xml" title="Apache Pulsar Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://pulsar.incubator.apache.org/blog/feed.xml" title="Apache Pulsar Blog RSS Feed"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-102219959-1', 'auto');
              ga('send', 'pageview');
            </script><link rel="stylesheet" href="/css/code-blocks-buttons.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/custom.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/en"><img class="logo" src="/img/pulsar.svg" alt="Apache Pulsar"/></a><a href="/en/versions"><h3>next</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/en/next/standalone" target="_self">Docs</a></li><li class=""><a href="/en/download" target="_self">Download</a></li><li class=""><a href="/docs/en/next/client-libraries" target="_self">Clients</a></li><li class=""><a href="#restapis" target="_self">REST APIs</a></li><li class=""><a href="#cli" target="_self">Cli</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li><li class=""><a href="#community" target="_self">Community</a></li><li class=""><a href="#apache" target="_self">Apache</a></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/img/language.svg" alt="Languages icon"/>English</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/docs/ja/next/functions-package">日本語</a></li><li><a href="/docs/fr/next/functions-package">Français</a></li><li><a href="/docs/ko/next/functions-package">한국어</a></li><li><a href="/docs/zh-CN/next/functions-package">中文</a></li><li><a href="/docs/zh-TW/next/functions-package">繁體中文</a></li><li><a href="https://crowdin.com/project/apache-pulsar" target="_blank" rel="noreferrer noopener">Help Translate</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(event) {
          event.preventDefault();

          if (languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/apache/incubator-pulsar/edit/master/site2/docs/functions-package.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 id="__docusaurus" class="postHeaderTitle">Package Pulsar Functions</h1></header><article><div><span><p>This section provides step-by-step instructions to package Pulsar functions in Java, Python, and Go.</p>
<blockquote>
<p><strong>Tip</strong></p>
<ul>
<li><p>Packaging a window function in Java is the same as <a href="#java">packaging a function in Java</a> as below.</p></li>
<li><p>Currently, the window function is not available in Python and Go.</p></li>
</ul>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="prerequisite"></a><a href="#prerequisite" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Prerequisite</h2>
<p>Before running a Pulsar function, you need to start Pulsar.</p>
<h3><a class="anchor" aria-hidden="true" id="run-a-standalone-pulsar-in-docker"></a><a href="#run-a-standalone-pulsar-in-docker" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Run a standalone Pulsar in Docker</h3>
<p>This example uses Docker to run a standalone Pulsar.</p>
<pre><code class="hljs css language-bash">docker run -it \
    -p 6650:6650 \
    -p 8080:8080 \
    -v <span class="hljs-variable">$PWD</span>/data:/pulsar/data \
    apachepulsar/pulsar:latest \
    bin/pulsar standalone
</code></pre>
<blockquote>
<p><strong>Tip</strong></p>
<ul>
<li><p><code>$PWD/data</code> is the local directory. <code>-v</code> maps the <code>/pulsar/data</code> directory in the Docker image to the local <code>$PWD/data</code> directory.</p></li>
<li><p>To check whether the image starts, use the command <code>docker ps</code>.</p></li>
</ul>
</blockquote>
<h3><a class="anchor" aria-hidden="true" id="run-pulsar-cluster-in-k8s"></a><a href="#run-pulsar-cluster-in-k8s" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Run Pulsar cluster in k8s</h3>
<p>For details about how to deploy a Pulsar cluster in the k8s environment, For details, see <a href="/docs/en/next/helm-overview">here</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="java"></a><a href="#java" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Java</h2>
<p>This example demonstrates how to package a function in Java.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>This example assumes that you have <a href="#run-a-standalone-pulsar-in-docker">run a standalone Pulsar in Docker</a> successfully.</p>
</blockquote>
<ol>
<li><p>Create a new maven project with a pom file.</p>
<blockquote>
<p><strong>Tip</strong></p>
<p><code>mainClass</code> is your package name.</p>
</blockquote>
<pre><code class="hljs css language-text"><?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>java-function</groupId>
    <artifactId>java-function</artifactId>
    <version>1.0-SNAPSHOT</version>

    <dependencies>
        <dependency>
            <groupId>org.apache.pulsar</groupId>
            <artifactId>pulsar-functions-api</artifactId>
            <version>2.6.0</version>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <artifactId>maven-assembly-plugin</artifactId>
                <configuration>
                    <appendAssemblyId>false</appendAssemblyId>
                    <descriptorRefs>
                        <descriptorRef>jar-with-dependencies</descriptorRef>
                    </descriptorRefs>
                    <archive>
                    <manifest>
                        <mainClass>org.example.test.ExclamationFunction</mainClass>
                    </manifest>
                </archive>
                </configuration>
                <executions>
                    <execution>
                        <id>make-assembly</id>
                        <phase>package</phase>
                        <goals>
                            <goal>assembly</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-compiler-plugin</artifactId>
                <configuration>
                    <source>8</source>
                    <target>8</target>
                </configuration>
            </plugin>
        </plugins>
    </build>

</project>
</code></pre></li>
<li><p>Write a Java function.</p>
<pre><code class="hljs">package org.example.test;

<span class="hljs-keyword">import</span> java.util<span class="hljs-function">.<span class="hljs-keyword">function</span>.<span class="hljs-title">Function</span></span>;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> ExclamationFunction <span class="hljs-keyword">implements</span> <span class="hljs-built_in">Function</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">String</span>&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">String</span> apply(<span class="hljs-built_in">String</span> s) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"This is my function!"</span>;
    }
}
</code></pre>
<blockquote>
<p><strong>Tip</strong></p>
<p>For the package imported, you can use one of the following interfaces:</p>
<ul>
<li><p>Function interface provided by Java 8: <code>java.util.function.Function</code></p></li>
<li><p>Pulsar Function interface: <code>org.apache.pulsar.functions.api.Function</code></p></li>
</ul>
<p>The main difference between the two interfaces is that the <code>org.apache.pulsar.functions.api.Function</code> interface provides the context interface. When you write a function and want to interact with it, you can use context to obtain a wide variety of information and functionality for Pulsar Functions.</p>
<p><strong>Example</strong></p>
<p>This example uses <code>org.apache.pulsar.functions.api.Function</code> interface with context.</p>
<pre><code class="hljs">package org.example.<span class="hljs-keyword">functions</span>;

<span class="hljs-keyword">import</span> org.apache.pulsar.<span class="hljs-keyword">functions</span>.api.Context;
<span class="hljs-keyword">import</span> org.apache.pulsar.<span class="hljs-keyword">functions</span>.api.<span class="hljs-keyword">Function</span>;

<span class="hljs-keyword">import</span> java.util.Arrays;

<span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> WordCountFunction implements <span class="hljs-keyword">Function</span>&lt;String, <span class="hljs-type">Void</span>&gt; {
   // This <span class="hljs-keyword">function</span> <span class="hljs-keyword">is</span> invoked every <span class="hljs-type">time</span> a message <span class="hljs-keyword">is</span> published <span class="hljs-keyword">to</span> the <span class="hljs-keyword">input</span> topic
   @Override
   <span class="hljs-built_in">public</span> <span class="hljs-type">Void</span> process(String <span class="hljs-keyword">input</span>, Context context) throws <span class="hljs-keyword">Exception</span> {
      Arrays.asList(<span class="hljs-keyword">input</span>.split(" ")).<span class="hljs-keyword">forEach</span>(word -&gt; {
          String counterKey = word.toLowerCase();
          context.incrCounter(counterKey, <span class="hljs-number">1</span>);
       });
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
  }
}
</code></pre>
</blockquote></li>
<li><p>Package the Java function.</p>
<pre><code class="hljs css language-bash">mvn package
</code></pre>
<p>After the Java function is packaged, a <code>target</code> directory is automatically created. Open the <code>target</code> directory to see if there is a jar package similar to <code>java-function-1.0-SNAPSHOT.jar</code>.</p></li>
</ol>
<ol start="4">
<li><p>Run the Java function.</p>
<p>(1) Copy the packaged jar file to the Pulsar image.</p>
<pre><code class="hljs css language-bash">docker <span class="hljs-built_in">exec</span> -it [CONTAINER ID] /bin/bash
docker cp &lt;path of java-function-1.0-SNAPSHOT.jar&gt;  CONTAINER ID:/pulsar
</code></pre>
<p>(2) Run the Java function using the following command.</p>
<pre><code class="hljs css language-bash">./bin/pulsar-admin <span class="hljs-built_in">functions</span> localrun \
--classname org.example.test.ExclamationFunction \
--jar java-function-1.0-SNAPSHOT.jar \
--inputs persistent://public/default/my-topic-1 \
--output persistent://public/default/<span class="hljs-built_in">test</span>-1 \
--tenant public \
--namespace default \
--name JavaFunction
</code></pre>
<p>The following log indicates that the Java function starts successfully.</p>
<pre><code class="hljs css language-text">...
07:55:03.724 [main] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Started process successfully
...
</code></pre>
<blockquote>
<p><strong>Tip</strong></p>
<ul>
<li><p>For the description about the parameters (for example, <code>--classname</code>, <code>--jar</code>, <code>--inputs</code>, and so on), run the command <code>./bin/pulsar-admin functions</code> or see <a href="/docs/en/next/pulsar-admin#functions">here</a>.</p></li>
<li><p>If you want to start a function in cluster mode, replace <code>localrun</code> with <code>create</code> in the command above. The following log indicates that the Java function starts successfully.</p>
<pre><code class="hljs css language-text">"Created successfully"
</code></pre></li>
</ul>
</blockquote></li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="python"></a><a href="#python" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Python</h2>
<p>Python Function supports the following three formats:</p>
<ul>
<li>One python file</li>
<li>ZIP file</li>
<li>PIP</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="one-python-file"></a><a href="#one-python-file" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>One python file</h3>
<p>This example demonstrates how to package a function by <strong>one python file</strong> in Python.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>This example assumes that you have <a href="#run-a-standalone-pulsar-in-docker">run a standalone Pulsar in Docker</a> successfully.</p>
</blockquote>
<ol>
<li><p>Write a Python function.</p>
<pre><code class="hljs"><span class="hljs-keyword">from</span> pulsar <span class="hljs-keyword">import</span> Function //  <span class="hljs-keyword">import</span> the Function module <span class="hljs-keyword">from</span> Pulsar

<span class="hljs-comment"># The classic ExclamationFunction that appends an exclamation at the end</span>
<span class="hljs-comment"># of the input</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExclamationFunction</span><span class="hljs-params">(Function)</span>:</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self)</span>:</span>
    <span class="hljs-keyword">pass</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process</span><span class="hljs-params">(self, input, context)</span>:</span>
    <span class="hljs-keyword">return</span> input + <span class="hljs-string">'!'</span>
</code></pre>
<p>In this example, when you write a Python function, you need to inherit the Function class and implement the <code>process()</code> method.</p>
<p><code>process()</code> mainly has two parameters:</p>
<ul>
<li><p><code>input</code> represents your input.</p></li>
<li><p><code>context</code> represents an interface exposed by the Pulsar Function. You can get the attributes in the Python function based on the provided context object.</p></li>
</ul></li>
<li><p>Install a Python client.</p>
<p>The implementation of a Python function depends on the Python client, so before deploying a Python function, you need to install the corresponding version of the Python client.</p>
<pre><code class="hljs css language-bash">pip install python-client==2.6.0
</code></pre></li>
<li><p>Run the Python Function.</p>
<p>(1) Copy the Python function file to the Pulsar image.</p>
<pre><code class="hljs css language-bash">docker <span class="hljs-built_in">exec</span> -it [CONTAINER ID] /bin/bash
docker cp &lt;path of Python <span class="hljs-keyword">function</span> file&gt;  CONTAINER ID:/pulsar
</code></pre>
<p>(2) Run the Python function using the following command.</p>
<pre><code class="hljs css language-bash">./bin/pulsar-admin <span class="hljs-built_in">functions</span> localrun \
--classname org.example.test.ExclamationFunction \
--py &lt;path of Python Function file&gt; \
--inputs persistent://public/default/my-topic-1 \
--output persistent://public/default/<span class="hljs-built_in">test</span>-1 \
--tenant public \
--namespace default \
--name PythonFunction
</code></pre>
<p>The following log indicates that the Python function starts successfully.</p>
<pre><code class="hljs css language-text">...
07:55:03.724 [main] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Started process successfully
...
</code></pre>
<blockquote>
<p><strong>Tip</strong></p>
<ul>
<li><p>For the description about the parameters (for example, <code>--classname</code>, <code>--py</code>, <code>--inputs</code>, and so on), run the command <code>./bin/pulsar-admin functions</code> or see <a href="/docs/en/next/pulsar-admin#functions">here</a>.</p></li>
<li><p>If you want to start a function in cluster mode, replace <code>localrun</code> with <code>create</code> in the command above. The following log indicates that the Python function starts successfully.</p>
<pre><code class="hljs css language-text">"Created successfully"
</code></pre></li>
</ul>
</blockquote></li>
</ol>
<h3><a class="anchor" aria-hidden="true" id="zip-file"></a><a href="#zip-file" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ZIP file</h3>
<p>This example demonstrates how to package a function by <strong>ZIP file</strong> in Python.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>This example assumes that you have <a href="#run-a-standalone-pulsar-in-docker">run a standalone Pulsar in Docker</a> successfully.</p>
</blockquote>
<ol>
<li>Prepare the ZIP file</li>
</ol>
<p>When packaging the ZIP file of the Python Function, the following requirements need to be met:</p>
<pre><code class="hljs css language-text">Assuming the zip file is named as `func.zip`, unzip the `func.zip` folder:
    "func/src"
    "func/requirements.txt"
    "func/deps"
</code></pre>
<p>Now we take <a href="https://github.com/apache/pulsar/tree/master/tests/docker-images/latest-version-image/python-examples">exclamation.zip</a> as an example, of which the internal structure is as follows:</p>
<pre><code class="hljs css language-text">.
├── deps
│   └── sh-1.12.14-py2.py3-none-any.whl
└── src
    └── exclamation.py
</code></pre>
<ol start="2">
<li><p>Run the Python Function</p>
<p>(1) Copy the ZIP file to the Pulsar image.</p>
<pre><code class="hljs css language-bash">docker <span class="hljs-built_in">exec</span> -it [CONTAINER ID] /bin/bash
docker cp &lt;path of ZIP file&gt;  CONTAINER ID:/pulsar
</code></pre>
<p>(2) Run the Python function using the following command.</p>
<pre><code class="hljs css language-bash">./bin/pulsar-admin <span class="hljs-built_in">functions</span> localrun \
--classname exclamation \
--py &lt;path of ZIP file&gt; \
--inputs persistent://public/default/<span class="hljs-keyword">in</span>-topic \
--output persistent://public/default/out-topic \
--tenant public \
--namespace default \
--name PythonFunction
</code></pre>
<p>The following log indicates that the Python function starts successfully.</p>
<pre><code class="hljs css language-text">...
07:55:03.724 [main] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Started process successfully
...
</code></pre>
<blockquote>
<p><strong>Tip</strong></p>
<ul>
<li><p>For the description about the parameters (for example, <code>--classname</code>, <code>--py</code>, <code>--inputs</code>, and so on), run the command <code>./bin/pulsar-admin functions</code> or see <a href="/docs/en/next/pulsar-admin#functions">here</a>.</p></li>
<li><p>If you want to start a function in cluster mode, replace <code>localrun</code> with <code>create</code> in the command above. The following log indicates that the Python function starts successfully.</p>
<pre><code class="hljs css language-text">"Created successfully"
</code></pre></li>
</ul>
</blockquote></li>
</ol>
<h3><a class="anchor" aria-hidden="true" id="pip"></a><a href="#pip" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>PIP</h3>
<p>This example demonstrates how to package a function by <strong>PIP</strong> in Python.</p>
<blockquote>
<p><strong>Note</strong></p>
<ul>
<li>The PIP method is only supported in the runtime of kubernetes.</li>
<li>This example assumes that you have <a href="#run-pulsar-cluster-in-k8s">run a Pulsar cluster in k8s</a> successfully.</li>
</ul>
</blockquote>
<ol>
<li>Config <code>functions_worker.yml</code>:</li>
</ol>
<pre><code class="hljs css language-text">#### Kubernetes Runtime ####
installUserCodeDependencies: true
</code></pre>
<ol start="2">
<li>Write your Python Function</li>
</ol>
<pre><code class="hljs"><span class="hljs-keyword">from</span> pulsar <span class="hljs-keyword">import</span> Function
<span class="hljs-keyword">import</span> js2xml

# The classic ExclamationFunction that appends an exclamation at the end
# of the input
<span class="hljs-keyword">class</span> <span class="hljs-symbol">ExclamationFunction</span>(<span class="hljs-symbol">Function</span>):
  <span class="hljs-symbol">def</span> <span class="hljs-symbol">__init__</span>(<span class="hljs-symbol">self</span>):
    <span class="hljs-symbol">pass</span>

  <span class="hljs-symbol">def</span> <span class="hljs-symbol">process</span>(<span class="hljs-symbol">self, <span class="hljs-symbol">input</span>, <span class="hljs-symbol">context</span></span>):
    // <span class="hljs-symbol">add</span> <span class="hljs-symbol">your</span> <span class="hljs-symbol">logic</span>
    <span class="hljs-symbol">return</span> <span class="hljs-symbol">input</span> + '!'
</code></pre>
<p>Here we can introduce additional dependencies. When Python Function detects that the file currently used is <code>whl</code> and the <code>installUserCodeDependencies</code> parameter is specified, the system will execute <code>pip install</code> to install the dependencies required in Python Function.</p>
<ol start="3">
<li>Generate the <code>whl</code> file</li>
</ol>
<pre><code class="hljs css language-shell script"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> <span class="hljs-variable">$PULSAR_HOME</span>/pulsar-functions/scripts/python</span>
<span class="hljs-meta">$</span><span class="bash"> chmod +x generate.sh</span>
<span class="hljs-meta">$</span><span class="bash"> ./generate.sh &lt;path of your Python Function&gt; &lt;path of the whl output dir&gt; &lt;the version of whl&gt;</span>
<span class="hljs-meta">#</span><span class="bash"> e.g: ./generate.sh /path/to/python /path/to/python/output 1.0.0</span>
</code></pre>
<p>Output in <code>/path/to/python/output</code>:</p>
<pre><code class="hljs css language-text">-rw-r--r--  1 root  staff   1.8K  8 27 14:29 pulsarfunction-1.0.0-py2-none-any.whl
-rw-r--r--  1 root  staff   1.4K  8 27 14:29 pulsarfunction-1.0.0.tar.gz
-rw-r--r--  1 root  staff     0B  8 27 14:29 pulsarfunction.whl
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="go"></a><a href="#go" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Go</h2>
<p>This example demonstrates how to package a function in Go.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>This example assumes that you have <a href="#run-a-standalone-pulsar-in-docker">run a standalone Pulsar in Docker</a> successfully.</p>
</blockquote>
<ol>
<li><p>Write a Go function.</p>
<p>Currently, Go function can be <strong>only</strong> implemented using SDK and the interface of the function is exposed in the form of SDK. Before using the Go function, you need to import &quot;github.com/apache/pulsar/pulsar-function-go/pf&quot;.</p>
<pre><code class="hljs"><span class="hljs-keyword">import</span> (
    <span class="hljs-string">"context"</span>
    <span class="hljs-string">"fmt"</span>

    <span class="hljs-string">"github.com/apache/pulsar/pulsar-function-go/pf"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">HandleRequest</span><span class="hljs-params">(ctx context.Context, input []<span class="hljs-keyword">byte</span>)</span> <span class="hljs-title">error</span></span> {
    fmt.Println(<span class="hljs-keyword">string</span>(input) + <span class="hljs-string">"!"</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    pf.Start(HandleRequest)
}
</code></pre>
<blockquote>
<p><strong>Tip</strong></p>
<p>You can use context to connect with the Go function.</p>
<pre><code class="hljs">if fc, ok := pf.FromContext(ctx); ok {
   fmt.Printf(<span class="hljs-string">"function ID is:%s, "</span>, fc.GetFuncID())
   fmt.Printf(<span class="hljs-string">"function version is:%s\n"</span>, fc.GetFuncVersion())
}
</code></pre>
</blockquote>
<blockquote>
<p><strong>Note</strong></p>
<ul>
<li><p>In <code>main()</code>, you <strong>only</strong> need to register the function name to <code>Start()</code>. <strong>Only</strong> one function name can be received in <code>Start()</code>.</p></li>
<li><p>Go function uses Go reflection based on the received function name to verify whether the parameter list and returned value list implemented are correct. The parameter list and returned value list specified <strong>must be</strong> one of the following sample functions:</p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">()</span></span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">()</span> <span class="hljs-title">error</span></span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(input)</span> <span class="hljs-title">error</span></span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">()</span> <span class="hljs-params">(output, error)</span></span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(input)</span> <span class="hljs-params">(output, error)</span></span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(context.Context)</span> <span class="hljs-title">error</span></span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(context.Context, input)</span> <span class="hljs-title">error</span></span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(context.Context)</span> <span class="hljs-params">(output, error)</span></span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(context.Context, input)</span> <span class="hljs-params">(output, error)</span></span>
</code></pre></li>
</ul>
</blockquote></li>
<li><p>Build the Go function.</p>
<pre><code class="hljs">go build &lt;your Go <span class="hljs-keyword">Function</span> <span class="hljs-title">filename&gt;.go</span> 
</code></pre></li>
<li><p>Run the Go Function.</p>
<p>(1) Copy the Go function file to the Pulsar image.</p>
<pre><code class="hljs css language-bash">docker <span class="hljs-built_in">exec</span> -it [CONTAINER ID] /bin/bash
docker cp &lt;your go <span class="hljs-keyword">function</span> path&gt;  CONTAINER ID:/pulsar
</code></pre>
<p>(2) Run the Go function with the following command.</p>
<pre><code class="hljs">./bin/pulsar-admin functions localrun \
    --go [your go <span class="hljs-function"><span class="hljs-keyword">function</span></span> path] 
    --inputs [input topics] \
    --output [output topic] \
    --tenant [<span class="hljs-keyword">default</span>:<span class="hljs-keyword">public</span>] \
    --namespace [<span class="hljs-keyword">default</span>:<span class="hljs-keyword">default</span>] \
    --<span class="hljs-keyword">name</span> [custom unique go <span class="hljs-function"><span class="hljs-keyword">function</span></span> <span class="hljs-keyword">name</span>] 
</code></pre>
<p>The following log indicates that the Go function starts successfully.</p>
<pre><code class="hljs css language-text">...
07:55:03.724 [main] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Started process successfully
...
</code></pre>
<blockquote>
<p><strong>Tip</strong></p>
<ul>
<li><p>For the description about the parameters (for example, <code>--classname</code>, <code>--go</code>, <code>--inputs</code>, and so on), run the command <code>./bin/pulsar-admin functions</code> or see <a href="/docs/en/next/pulsar-admin#functions">here</a>.</p></li>
<li><p>If you want to start a function in cluster mode, replace <code>localrun</code> with <code>create</code> in the command above. The following log indicates that the Go function starts successfully.</p>
<pre><code class="hljs css language-text">"Created successfully"
</code></pre></li>
</ul>
</blockquote></li>
</ol>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#prerequisite">Prerequisite</a><ul class="toc-headings"><li><a href="#run-a-standalone-pulsar-in-docker">Run a standalone Pulsar in Docker</a></li><li><a href="#run-pulsar-cluster-in-k8s">Run Pulsar cluster in k8s</a></li></ul></li><li><a href="#java">Java</a></li><li><a href="#python">Python</a><ul class="toc-headings"><li><a href="#one-python-file">One python file</a></li><li><a href="#zip-file">ZIP file</a></li><li><a href="#pip">PIP</a></li></ul></li><li><a href="#go">Go</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="copyright">Copyright © 2020 The Apache Software Foundation. All Rights Reserved. Apache, Apache Pulsar and the Apache feather logo are trademarks of The Apache Software Foundation.</section><span><script>
      const community = document.querySelector("a[href='#community']").parentNode;
      const communityMenu =
        '<li>' +
        '<a id="community-menu" href="#">Community <span style="font-size: 0.75em">&nbsp;▼</span></a>' +
        '<div id="community-dropdown" class="hide">' +
          '<ul id="community-dropdown-items">' +
            '<li><a href="/en/contact">Contact</a></li>' +
            '<li><a href="/en/contributing">Contributing</a></li>' +
            '<li><a href="/en/coding-guide">Coding guide</a></li>' +
            '<li><a href="/en/events">Events</a></li>' +
            '<li><a href="https://twitter.com/Apache_Pulsar" target="_blank">Twitter &#x2750</a></li>' +
            '<li><a href="https://github.com/apache/pulsar/wiki" target="_blank">Wiki &#x2750</a></li>' +
            '<li><a href="https://github.com/apache/pulsar/issues" target="_blank">Issue tracking &#x2750</a></li>' +
            '<li><a href="https://pulsar-summit.org/" target="_blank">Pulsar Summit &#x2750</a></li>' +
            '<li>&nbsp;</li>' +
            '<li><a href="/en/resources">Resources</a></li>' +
            '<li><a href="/en/team">Team</a></li>' +
            '<li><a href="/en/powered-by">Powered By</a></li>' +
          '</ul>' +
        '</div>' +
        '</li>';

      community.innerHTML = communityMenu;

      const communityMenuItem = document.getElementById("community-menu");
      const communityDropDown = document.getElementById("community-dropdown");
      communityMenuItem.addEventListener("click", function(event) {
        event.preventDefault();

        if (communityDropDown.className == 'hide') {
          communityDropDown.className = 'visible';
        } else {
          communityDropDown.className = 'hide';
        }
      });
    </script></span></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'd226a455cecdd4bc18a554c1b47e5b52',
                indexName: 'apache_pulsar',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["language:en","version:next"]}
              });
            </script></body></html>